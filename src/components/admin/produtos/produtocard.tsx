import { useState } from "react";
import CustomButton from "../../buttons/CustomButton"; // Bot√£o azul para editar
import { Product } from "@/types/product"; // Tipo do produto (com nome, imagem, pre√ßo, etc)
import DeleteButton from "@/components/buttons/DeleteButton"; // Bot√£o vermelho para deletar

// ‚¨áÔ∏è Aqui dizemos o que o componente precisa receber:
interface ProdutoCardProps {
  produto: Product; // O produto que vai aparecer no cart√£o
  onRemover: (id: number) => void; // Fun√ß√£o para remover um produto
  onEditar: (produto: Product) => void; // Fun√ß√£o para editar um produto
}

// ‚¨áÔ∏è Este √© o cart√£o de produto que ser√° mostrado na tela do admin
export default function ProdutoCard({
  produto,
  onRemover,
  onEditar,
}: ProdutoCardProps) {
  const [loading, setLoading] = useState(false); // Diz se est√° excluindo o produto

  // üóëÔ∏è Fun√ß√£o que remove o produto quando o bot√£o for clicado
  const removerProduto = async () => {
    // Antes de remover, mostramos uma perguntinha pro usu√°rio confirmar
    if (!confirm("Deseja realmente excluir este produto?")) return;

    setLoading(true); // Mostramos que est√° carregando...

    // Pegamos o token do admin que est√° salvo no navegador
    const token = localStorage.getItem("adminToken");

    // Enviamos uma requisi√ß√£o para o servidor pedindo para apagar o produto
    const res = await fetch(`http://localhost:5000/admin/produtos/${produto.id}`, {
      method: "DELETE",
      headers: {
        Authorization: `Bearer ${token}`, // Enviamos o crach√° do admin junto
      },
    });

    // Se deu tudo certo, chamamos a fun√ß√£o que remove da tela
    if (res.ok) {
      onRemover(produto.id);
    } else {
      alert("Erro ao remover produto.");
    }

    setLoading(false); // Terminamos o carregamento
  };

  return (
    <div className="bg-white p-4 shadow rounded">
      {/* Imagem do produto */}
      <img
        src={produto.image}
        alt={produto.name}
        className="w-full h-40 object-cover mb-2 rounded"
      />

      {/* Nome do produto em destaque */}
      <h2 className="font-bold">{produto.name}</h2>

      {/* Descri√ß√£o em texto pequeno e cinza */}
      <p className="text-sm text-gray-600">{produto.description}</p>

      {/* Pre√ßo formatado em reais */}
      <p className="text-sm">
        Pre√ßo:{" "}
        {produto.price
          ? Number(produto.price).toLocaleString("pt-BR", {
              style: "currency",
              currency: "BRL",
            })
          : "N/A"}
      </p>

      {/* Quantidade do produto */}
      <p className="text-sm">Qtd: {produto.quantity}</p>

      {/* Bot√µes de a√ß√£o: Editar e Remover */}
      <div className="mt-4 flex gap-2">
        {/* Bot√£o azul de editar */}
        <CustomButton
          label="Editar"
          onClick={() => onEditar(produto)} // Chama a fun√ß√£o para editar o produto
          variant="primary"
          isLoading={false}
          size="small"
        />

        {/* Bot√£o vermelho de deletar */}
        <DeleteButton onConfirm={() => onRemover(produto.id)} />
      </div>
    </div>
  );
}
// Aqui usamos o CustomButton para o bot√£o de editar e DeleteButton para o de remover
// O CustomButton √© um bot√£o azul que mostra um texto e chama uma fun√ß√£o quando clicado